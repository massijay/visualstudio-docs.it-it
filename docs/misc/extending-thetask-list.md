---
title: "Estensione dell&#39;elenco attivit&#224; | Microsoft Docs"
ms.custom: ""
ms.date: "12/15/2016"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "devlang-csharp"
ms.tgt_pltfrm: ""
ms.topic: "article"
helpviewer_keywords: 
  - "Elenco attività"
ms.assetid: 9d84c9c4-7796-4fa1-86f8-22d077b79f7e
caps.latest.revision: 17
caps.handback.revision: 17
manager: "douge"
---
# Estensione dell&#39;elenco attivit&#224;
L'**Elenco attività** di [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] consente agli utenti di aggiungere attività di programmazione personalizzate, visualizzare commenti alle attività collegati alle righe di codice, oltre che creare e visualizzare categorie personalizzate per i messaggi delle attività.  
  
 Le attività vengono gestite tramite un servizio denominato <xref:Microsoft.VisualStudio.Shell.Interop.SVsTaskList>, che implementa <xref:Microsoft.VisualStudio.Shell.Interop.IVsTaskList> e <xref:Microsoft.VisualStudio.Shell.Interop.IVsTaskList2>. Per usare le funzionalità di base dell'**Elenco attività** occorre creare un provider di attività implementando <xref:Microsoft.VisualStudio.Shell.Interop.IVsTaskProvider>.  
  
 Registrare il provider di attività con il servizio <xref:Microsoft.VisualStudio.Shell.Interop.SVsTaskList> chiamando <xref:Microsoft.VisualStudio.Shell.Interop.IVsTaskList.RegisterTaskProvider%2A>, che restituisce un valore di cookie che va usato per identificare in modo univoco il provider di attività in tutte le transazioni successive.  
  
 Ogni implementazione di provider di attività è responsabile della gestione di un elenco di attività interno. Il provider di attività può chiamare <xref:Microsoft.VisualStudio.Shell.Interop.IVsTaskList.RefreshTasks%2A> sull'**Elenco attività** per aggiornare l'elenco di attività visualizzato. Quando avviene questo:  
  
1.  Il servizio richiama il provider di attività usando il metodo <xref:Microsoft.VisualStudio.Shell.Interop.IVsTaskProvider.EnumTaskItems%2A>.  
  
2.  L'implementazione del provider di attività di <xref:Microsoft.VisualStudio.Shell.Interop.IVsTaskProvider.EnumTaskItems%2A> restituisce un oggetto <xref:Microsoft.VisualStudio.Shell.Interop.IVsEnumTaskItems>.  
  
3.  L'oggetto <xref:Microsoft.VisualStudio.Shell.Interop.IVsEnumTaskItems> scorre una raccolta di oggetti <xref:Microsoft.VisualStudio.Shell.Interop.IVsTaskItem>.  
  
4.  Quindi, il servizio <xref:Microsoft.VisualStudio.Shell.Interop.SVsTaskList> aggiorna la visualizzazione dell'**Elenco attività**.  
  
 Sono disponibili funzionalità aggiuntive. L'interfaccia <xref:Microsoft.VisualStudio.Shell.Interop.IVsTaskProvider3> consente a ogni provider di attività per fornire un proprio set di colonne personalizzato.  
  
## Esempio  
 Nell'esempio di codice seguente viene illustrata l'implementazione di un provider di attività.  
  
```vb#  
Class TaskProvider Implements ITaskProvider Implements IVsSolutionEvents Public Sub New(ByVal provider As IServiceProvider) _imageList.ImageSize = New Size(9, 16) _imageList.Images.AddStrip(Resources.priority) _imageList.TransparentColor = Color.FromArgb(0, 255, 0) _serviceProvider = provider Dim taskList As IVsTaskList = TryCast(_serviceProvider.GetService(GetType(SVsTaskList)), IVsTaskList) Dim hr As Integer = taskList.RegisterTaskProvider(Me, _cookie) Debug.Assert(hr = VSConstants.S_OK, "RegisterTaskProvider did not return S_OK.") Debug.Assert(_cookie <> 0, "RegisterTaskProvider did not return a nonzero cookie.") SetCommandHandlers() ListenForProjectUnload() End Sub #Region "ITaskProvider Members" Public Sub AddResult(ByVal result As IScanResult, ByVal projectFile As String) Dim fullPath As String = result.FilePath If Not Path.IsPathRooted(fullPath) Then fullPath = Utilities.AbsolutePathFromRelative(fullPath, Path.GetDirectoryName(projectFile)) End If If result.Scanned Then For Each hit As IScanHit In result.Results If hit.Warning IsNot Nothing AndAlso hit.Warning.Length > 0 Then ' See if we've warned about this term before; ' if so, don't warn again. If _termsWithDuplicateWarning.Find(Function(ByVal item As String) [String].Compare(item, hit.Term.Text, StringComparison.OrdinalIgnoreCase) = 0) Is Nothing Then _tasks.Add(New Task(hit.Term.Text, hit.Term.Severity, hit.Term.[Class], hit.Warning, "", "", _ -1, -1, "", "", Me, _serviceProvider)) _termsWithDuplicateWarning.Add(hit.Term.Text) End If End If _tasks.Add(New Task(hit.Term.Text, hit.Term.Severity, hit.Term.[Class], hit.Term.Comment, hit.Term.RecommendedTerm, fullPath, _ hit.Line, hit.Column, projectFile, hit.LineText, Me, _serviceProvider)) Next Else _tasks.Add(New Task("", 1, "", [String].Format(CultureInfo.CurrentUICulture, Resources.FileNotScannedError, fullPath), "", fullPath, _ -1, -1, projectFile, "", Me, _serviceProvider)) End If Refresh() End Sub Public Sub Clear() _tasks.Clear() Refresh() End Sub Public Sub SetAsActiveProvider() Dim taskList As IVsTaskList2 = TryCast(_serviceProvider.GetService(GetType(SVsTaskList)), IVsTaskList2) Dim ourGuid As Guid = _providerGuid Dim hr As Integer = taskList.SetActiveProvider(ourGuid) Debug.Assert(hr = VSConstants.S_OK, "SetActiveProvider did not return S_OK.") End Sub Public Sub ShowTaskList() Dim shell As IVsUIShell = TryCast(_serviceProvider.GetService(GetType(SVsUIShell)), IVsUIShell) Dim dummy As Object = Nothing Dim cmdSetGuid As Guid = VSConstants.GUID_VSStandardCommandSet97 Dim hr As Integer = shell.PostExecCommand(cmdSetGuid, CInt(VSConstants.VSStd97CmdID.TaskListWindow), 0, dummy) Debug.Assert(hr = VSConstants.S_OK, "SetActiveProvider did not return S_OK.") End Sub ''' <summary> ''' Returns an image index between 0 and 2 inclusive corresponding ''' to the specified severity. ''' </summary> Public Shared Function GetImageIndexForSeverity(ByVal severity As Integer) As Integer Return Math.Max(1, Math.Min(3, severity)) - 1 End Function Public ReadOnly Property IsShowingIgnoredInstances() As Boolean Get Return _showingIgnoredInstances End Get End Property #End Region #Region "IVsTaskProvider Members" Public Function EnumTaskItems(ByRef ppenum As IVsEnumTaskItems) As Integer ppenum = New TaskEnumerator(_tasks, IsShowingIgnoredInstances) Return VSConstants.S_OK End Function <DllImport("comctl32.dll")> _ Private Shared Function ImageList_Duplicate(ByVal original As IntPtr) As IntPtr End Function Public Function ImageList(ByRef phImageList As IntPtr) As Integer phImageList = ImageList_Duplicate(_imageList.Handle) Return VSConstants.S_OK End Function Public Function OnTaskListFinalRelease(ByVal pTaskList As IVsTaskList) As Integer If (_cookie <> 0) AndAlso (pTaskList IsNot Nothing) Then Dim hr As Integer = pTaskList.UnregisterTaskProvider(_cookie) Debug.Assert(hr = VSConstants.S_OK, "UnregisterTaskProvider did not return S_OK.") End If Return VSConstants.S_OK End Function Public Function ReRegistrationKey(ByRef pbstrKey As String) As Integer pbstrKey = "" Return VSConstants.E_NOTIMPL End Function Public Function SubcategoryList(ByVal cbstr As UInteger, ByVal rgbstr As String(), ByRef pcActual As UInteger) As Integer pcActual = 0 Return VSConstants.E_NOTIMPL End Function End Class  
```  
  
```c#  
class TaskProvider : ITaskProvider, IVsSolutionEvents { public TaskProvider(IServiceProvider provider) { _imageList.ImageSize = new Size(9, 16); _imageList.Images.AddStrip(Resources.priority); _imageList.TransparentColor = Color.FromArgb(0, 255, 0); _serviceProvider = provider; IVsTaskList taskList = _serviceProvider.GetService(typeof(SVsTaskList)) as IVsTaskList; int hr = taskList.RegisterTaskProvider(this, out _cookie); Debug.Assert(hr == VSConstants.S_OK, "RegisterTaskProvider did not return S_OK."); Debug.Assert(_cookie != 0, "RegisterTaskProvider did not return a nonzero cookie."); SetCommandHandlers(); ListenForProjectUnload(); } #region ITaskProvider Members public void AddResult(IScanResult result, string projectFile) { string fullPath = result.FilePath; if (!Path.IsPathRooted(fullPath)) { fullPath = Utilities.AbsolutePathFromRelative(fullPath, Path.GetDirectoryName(projectFile)); } if (result.Scanned) { foreach (IScanHit hit in result.Results) { if (hit.Warning != null && hit.Warning.Length > 0) { // See if we've warned about this term before; // if so, don't warn again. if (null == _termsWithDuplicateWarning.Find( delegate(string item) { return String.Compare(item, hit.Term.Text, StringComparison.OrdinalIgnoreCase) == 0; })) { _tasks.Add(new Task(hit.Term.Text, hit.Term.Severity, hit.Term.Class, hit.Warning, "", "", -1, -1, "", "", this, _serviceProvider)); _termsWithDuplicateWarning.Add(hit.Term.Text); } } _tasks.Add(new Task(hit.Term.Text, hit.Term.Severity, hit.Term.Class, hit.Term.Comment, hit.Term.RecommendedTerm, fullPath, hit.Line, hit.Column, projectFile, hit.LineText, this, _serviceProvider)); } } else { _tasks.Add(new Task("", 1, "", String.Format(CultureInfo.CurrentUICulture, Resources.FileNotScannedError, fullPath), "", fullPath, -1, -1, projectFile, "", this, _serviceProvider)); } Refresh(); } public void Clear() { _tasks.Clear(); Refresh(); } public void SetAsActiveProvider() { IVsTaskList2 taskList = _serviceProvider.GetService(typeof(SVsTaskList)) as IVsTaskList2; Guid ourGuid = _providerGuid; int hr = taskList.SetActiveProvider(ref ourGuid); Debug.Assert(hr == VSConstants.S_OK, "SetActiveProvider did not return S_OK."); } public void ShowTaskList() { IVsUIShell shell = _serviceProvider.GetService(typeof(SVsUIShell)) as IVsUIShell; object dummy = null; Guid cmdSetGuid = VSConstants.GUID_VSStandardCommandSet97; int hr = shell.PostExecCommand(ref cmdSetGuid, (int)VSConstants.VSStd97CmdID.TaskListWindow, 0, ref dummy); Debug.Assert(hr == VSConstants.S_OK, "SetActiveProvider did not return S_OK."); } /// <summary> /// Returns an image index between 0 and 2 inclusive corresponding /// to the specified severity. /// </summary> public static int GetImageIndexForSeverity(int severity) { return Math.Max(1, Math.Min(3, severity)) - 1; } public bool IsShowingIgnoredInstances { get { return _showingIgnoredInstances; } } #endregion #region IVsTaskProvider Members public int EnumTaskItems(out IVsEnumTaskItems ppenum) { ppenum = new TaskEnumerator(_tasks, IsShowingIgnoredInstances); return VSConstants.S_OK; } [DllImport("comctl32.dll")] static extern IntPtr ImageList_Duplicate(IntPtr original); public int ImageList(out IntPtr phImageList) { phImageList = ImageList_Duplicate(_imageList.Handle); return VSConstants.S_OK; } public int OnTaskListFinalRelease(IVsTaskList pTaskList) { if ((_cookie != 0) && (null != pTaskList)) { int hr = pTaskList.UnregisterTaskProvider(_cookie); Debug.Assert(hr == VSConstants.S_OK, "UnregisterTaskProvider did not return S_OK."); } return VSConstants.S_OK; } public int ReRegistrationKey(out string pbstrKey) { pbstrKey = ""; return VSConstants.E_NOTIMPL; } public int SubcategoryList(uint cbstr, string[] rgbstr, out uint pcActual) { pcActual = 0; return VSConstants.E_NOTIMPL; } }  
```  
  
## Vedere anche  
 [Creazione di visualizzazioni personalizzate dell'elenco attività](/visual-cpp/misc/creating-custom-task-list-views)   
 [Procedura: Creare categorie personalizzate di elenchi di attività](../misc/how-to-create-custom-categories-of-task-lists.md)